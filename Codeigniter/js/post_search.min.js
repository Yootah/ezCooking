$(document).ready(function() {
    
    $advform = $("#advancedSearch").children();
    $advform.hide();
    $hidden = true;
    
    var updateSearch = function(state) {
        
	    if (state.charAt(1)=='a') {
	        $advform.show();
            $hidden = false;
            $("#advanced-btn").children()[0].href = "#/advanced";
            $("#advanced-btn").children()[0].text = lang_hide;
            document.title = lang_advanced;//state.charAt(1).toUpperCase() + state.slice(2)+" search";
	    }
	    else if(state.charAt(1)=='s'){
	        $advform.hide();
            $hidden = true;
            $("#advanced-btn").children()[0].href = "#/simple";
            $("#advanced-btn").children()[0].text = lang_advanced;
            document.title = lang_simple;//state.charAt(1).toUpperCase() + state.slice(2)+" search";
	    }
	    else {
	        $.History.go('/simple');
	    }
	}
	
    var hash = (window.location.href).substring(33);
    
        updateSearch(hash);

      $("form#searchform").submit(function(e) {
           e.preventDefault(); //prevent default form submission
           var search = $("input#search").val(); 
           var auth = $("input#auth-name").val();
           var options = $(".sort-type-select").children();
           var selected = null;
           for(var i = 0; i<3; i++){
               if(options[i].firstChild.checked){
                   selected = options[i].firstChild;
               }
           }
           $.post("search/show_search/", {search: search, author: auth, order: selected.value}, function(data) {
               $("div#searchresults").html(data);
          });
          return false
      });
    
    $("#advanced-btn").click(function() {
        if ($hidden) {
            $advform.show();
            $hidden = false;
            $("#advanced-btn").children()[0].href = "#/advanced";
        }
        else {
            $advform.hide();
            $hidden = true;
            $("#advanced-btn").children()[0].href = "#/simple";
            $("#auth-name").value = "";
        }
    });
    
    $.History.bind(function(state){
            updateSearch(state);
            // Update the page's title with our current state on the end
            if (state.charAt(1)=='s') 
               document.title = lang_simple; //state.charAt(1).toUpperCase() + state.slice(2)+" search";
            else if (state.charAt(1)=='a') 
               document.title = lang_advanced;
			});
			
});